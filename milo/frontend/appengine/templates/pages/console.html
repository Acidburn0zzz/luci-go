{{define "title"}}{{ .Console.Name }} Console{{end}}

{{define "head"}}
{{ if .Console.FaviconURL }}
<link rel="icon" type="{{ .Console.FaviconURL | faviconMIMEType }}" href="{{ .Console.FaviconURL }}" />
{{ end }}

{{ if .Reload }}
<meta http-equiv="refresh" content="{{ .Reload }}">
{{ end }}
<link rel="stylesheet" href="/static/common/css/console.css" type="text/css">
{{end}}

{{define "body"}}
{{ $console := .Console }}

<!-- Title -->
<div class="console-title">
{{ if $console.FaviconURL }}
  <img src="{{ .Console.FaviconURL }}" />
{{ end }}

  <h1>{{ $console.Name }}</h1>
</div>

<!-- Header -->
{{ if $console.Header }}
{{ $header := $console.Header }}
<div class="console-header">
  <div class="console-header-column-lists">

    <!-- Oncalls -->
    <div class="console-header-group">
      <div class="console-header-group-title">Oncalls</div>
      <div class="console-header-list">
        <div class="console-header-groups">
        {{ range $header.Oncalls }}
          <div class="console-header-oncalls-group">
            <div class="console-header-group-name">
              {{ .Name }}
            </div>
            <div class="console-header-group-content">
              {{ $numEmails := (len .Emails) }}
              {{ if gt $numEmails 0 }}
                {{ range $i, $email := .Emails }}
                  <span>{{ . | obfuscateEmail }}{{ if lt $i (sub $numEmails 1) }},{{ end }}</span>
                {{ end }}
              {{ else if .Primary }}
                <span>{{ .Primary }}</span>
                {{if .Secondaries }}
                  (primary)
                  {{ range .Secondaries }}
                    <span>, {{ . }}</span>
                  {{ end }}
                {{ end }}
              {{ else }}
                <span>&lt;none&gt;</span>
              {{ end }}
            </div>
          </div>
        {{ end }}
        </div>
      </div>
    </div>

    <!-- Links -->
    <div class="console-header-group">
      <div class="console-header-group-title">Links</div>
      <div class="console-header-list">
        <div class="console-header-groups">
        {{ range $header.Links }}
          <div class="console-header-links-group">
            <div class="console-header-group-name">{{ .Name }}</div>
            <div class="console-header-group-content">
            {{ range .Links }}
              <span>{{ .HTML }}</span>
            {{ end }}
            </div>
          </div>
        {{ end }}
        </div>
      </div>
    </div>
  </div>

{{ if $header.ConsoleGroups }}
  <div class="console-header-column-summaries">
  {{ range $header.ConsoleGroups }}

    <!-- Header Group -->
    <!-- If the title is nil, don't wrap it in a special div. -->
    {{ if .Title }}
    <div class="console-header-group">
      <div class="console-header-group-title">
        {{ .Title.HTML }}
      </div>
    {{ end }}
      <div class="console-header-summaries">
      {{ range .Consoles }}
        <div class="console-builder-summary">
          <div class="console-header-name">
            {{ .Name.HTML }}
          </div>
          {{ $console_name := .Name.Link.Label }}
          {{ range .Builders }}
            <a class="console-builder-status"
               href="/{{ .LastFinishedBuildID }}"
               title="{{ .LastFinishedBuildID }}"
               aria-label="builder {{ .BuilderID }} on console {{ $console_name }} has last status {{ .LastFinishedStatus }}">
              <div class="console-header-builder status-{{ .LastFinishedStatus }}"></div>
            </a>
          {{ end }}
        </div>
      {{ end }}
      </div>
    <!-- If the title is nil, don't wrap it in a special div. -->
    {{ if .Title }}
    </div>
    {{ end }}

  {{ end }}
  </div>
{{ end }}
</div>
{{ end }}

<!-- Legend -->
<div id="legend">
  <table>
    <tr>
      <td>Legend:&nbsp;&nbsp;</td>
      <td class="status-Success" title="All tests passed">Passed</td>
      <td class="status-Failure" title="There is a new failure. Take a look!">Failed</td>
      <td class="status-Warning" title="It was failing before, and is still failing. Make sure you did not introduce new regressions">Failed&nbsp;Again</td>
      <td class="status-Running" title="The tests are still running">Running</td>
      <td class="status-Exception" title="Something went wrong with the test, there is no result">Exception</td>
    </tr>
  </table>
</div>
<div class="clear"></div>

<!-- Container -->
<div class="console-row">

  <!-- Commits -->
  <div class="console-column" style="justify-content: flex-end">
    <div class="console-row">
      <div class="console-commit-column">
      {{ range $console.Commit }}
        <div class="console-commit-item">{{ .CommitTime | localTime "N/A" }}</div>
      {{ end }}
      </div>
      <div class="console-commit-column">
      {{ range $console.Commit }}
        <div class="console-commit-item">
          <a href="{{.Revision.URL}}">
            <span class="commit" title="{{ .Description }}">
              {{ .AuthorEmail }}
            </span>
          </a>
        </div>
      {{ end }}
      </div>
    </div>
  </div>

  <!-- Table -->
  {{ $console.ConsoleTable }}
</div>

<div class="epiloge" style="margin-top: 1em">
  (Show:
  <a href="?numbuilds=">default</a>
  <a href="?numbuilds=25">25</a>
  <a href="?numbuilds=50">50</a>
  <a href="?numbuilds=100">100</a>
  <a href="?numbuilds=200">200</a>
  )
</div>

{{end}} <!-- Body -->
